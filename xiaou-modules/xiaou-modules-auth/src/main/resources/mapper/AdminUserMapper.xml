<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiaou.auth.admin.mapper.AdminUserMapper">

    <!-- 查询所有管理员用户及其角色信息 -->
    <select id="selectUsersWithRoles" resultType="java.util.Map">
        SELECT 
            au.id AS id,
            au.username AS username,
            GROUP_CONCAT(sr.role_code) AS roles
        FROM admin_user au
        LEFT JOIN sys_user_role sur ON au.id COLLATE utf8mb4_general_ci = sur.user_id AND sur.user_type = 'ADMIN'
        LEFT JOIN sys_role sr ON sur.role_id = sr.id
        GROUP BY au.id, au.username
        ORDER BY au.username
    </select>

    <!-- 根据用户ID查询用户角色代码 -->
    <select id="selectUserRoleCodes" resultType="java.lang.String">
        SELECT sr.role_code
        FROM sys_user_role sur
        JOIN sys_role sr ON sur.role_id = sr.id
        WHERE sur.user_id = #{userId} COLLATE utf8mb4_general_ci
        AND sur.user_type = 'ADMIN'
    </select>

</mapper> 